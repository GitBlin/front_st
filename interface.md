**1. ç®€ä»‹**

è¿™æ˜¯ä¸€ä¸ªåŸºäº AI çš„äº¤äº’å¼æ²Ÿé€šåŸ¹è®­ç³»ç»Ÿã€‚ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼ŒAPIä¸ä»…ä¼šè¿”å›AIçš„å›å¤ï¼Œè¿˜ä¼šæä¾›è®­ç»ƒæç¤ºã€‚

**2. å¿«é€Ÿå¼€å§‹ğŸš€**

2.1 NPCå›å¤è¯·æ±‚ç¤ºä¾‹

```
import requests

API_KEY_ST = "app-aIUuahdtoG3d4ek0p2VZWqej"
API_URL_ST = "http://dify.ai-role.cn/v1/chat-messages"

HEADERS_LLM = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {API_KEY_ST}"
}

conversation_id = None

payload = {
    "inputs": {
	    "Custom":1,
        "title": "èŒåœºåŠŸåŠ³äº‰å¤ºæˆ˜",
		"score":score
    },
    "query": "ç”¨æˆ·å‘è¨€ä¿¡æ¯",
    "response_mode": "blocking",
    "conversation_id": conversation_id,
    "user": "abc-123456",
}
response = requests.post(API_URL_ST, headers=HEADERS_LLM, json=payload)
print(response.json())


```
å‚æ•°è¯´æ˜:

query - ç”¨æˆ·æœ€æ–°å‘è¨€ï¼ˆç”¨æˆ·è¾“å…¥å­—æ®µï¼‰

score - ä¾ä»æŠµæŠ—å€¼ï¼Œåˆå§‹ä¸º8ï¼ˆåç»­è¯·æ±‚çš„å€¼ä¸º3.2â€œæ•™å­¦åé¦ˆå“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

inputs - è¯·æ±‚æºå¸¦çš„å‚æ•°

title - åœºæ™¯å¯¹è¯ä¸»é¢˜

response_mode - å“åº”æ¨¡å¼ï¼šstreamingï¼šåŸºäºSSEï¼›blockingï¼šç­‰å¾…æ‰§è¡Œå®Œæ¯•åè¿”å›(Cloudflare 100ç§’è¶…æ—¶é™åˆ¶)ã€‚

user - ç”¨æˆ·IDå­—æ®µ --- åŒºåˆ†ä¸åŒç”¨æˆ·ã€‚

auto_generate_name - åˆ›å»ºå¯¹è¯åç§°ï¼šTrueä¸ºè‡ªåŠ¨åˆ›å»ºï¼ŒFalseç›¸åã€‚

conversation_id - å¯¹è¯idï¼šæ ‡è¯†æ¯æ®µå¯¹è¯çš„å”¯ä¸€IDï¼Œåˆå§‹æ—¶ä¸ºç©ºï¼Œç”¨äºç»§ç»­ä¹‹å‰çš„å¯¹è¯ã€‚

2.2 æ•™å­¦åé¦ˆè¯·æ±‚ç¤ºä¾‹

```
import requests

API_KEY_ST = "app-ynIc5g2MYm3Wh5NcjKoYumh6"
API_URL_ST = "http://dify.ai-role.cn/v1/chat-messages"

HEADERS_LLM = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {API_KEY_ST}"
}

conversation_id = None

payload = {
    "inputs": {
	    "Custom":1,
        "title": "èŒåœºåŠŸåŠ³äº‰å¤ºæˆ˜",
		"user_message":"ç”¨æˆ·æœ€æ–°å‘è¨€",
		"bot_message":"NPCæœ€æ–°å›å¤",
		"score":score
    },
    "query": "è¯·æ±‚æ•™å­¦åé¦ˆ",
    "response_mode": "blocking",
    "conversation_id": conversation_id,
    "user": "abc-123456",
}
response = requests.post(API_URL_ST, headers=HEADERS_LLM, json=payload)
print(response.json())
```
å‚æ•°è¯´æ˜ï¼š

query - é»˜è®¤ä¸ºï¼šè¯·æ±‚æ•™å­¦åé¦ˆ

Custom - è¡¨ç¤ºä¸åŒä»»åŠ¡ï¼Œä¸º1æ—¶è¡¨ç¤ºç”¨æˆ·ç»§ç»­å¯¹è¯ï¼Œåˆ™è¿”å›æ•™å­¦åé¦ˆï¼Œä¸º0æ—¶è¡¨ç¤ºç”¨æˆ·ç»“æŸå¯¹è¯ï¼Œåˆ™è¿”å›è¯„ä¼°æŠ¥å‘Šï¼ˆæ³¨ï¼šè‹¥Custom==1ï¼Œä½†current_stage==5(è¾¾æˆç›®æ ‡å¯¹è¯æˆåŠŸ)ï¼Œä¹Ÿè‡ªåŠ¨è¿”å›è¯„ä¼°æŠ¥å‘Šï¼‰

title - åœºæ™¯å¯¹è¯ä¸»é¢˜

user_message - ç”¨æˆ·æœ€æ–°å‘è¨€ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

bot_message - NPCæœ€æ–°å›å¤ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

score - NPCå½“å‰ä¾ä»å¯¹æŠ—ç³»æ•°ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

2.3 è¯„ä¼°æŠ¥å‘Šè¯·æ±‚ç¤ºä¾‹


```
import requests

API_KEY_ST = "app-ynIc5g2MYm3Wh5NcjKoYumh6"
API_URL_ST = "http://dify.ai-role.cn/v1/chat-messages"

HEADERS_LLM = {
    "Content-Type": "application/json",
    "Authorization": f"Bearer {API_KEY_ST}"
}

conversation_id = None

payload = {
    "inputs": {
	    "Custom":0,
        "title": "èŒåœºåŠŸåŠ³äº‰å¤ºæˆ˜",
		"user_message":"ç”¨æˆ·æœ€æ–°å‘è¨€",
		"bot_message":"NPCæœ€æ–°å›å¤",
		"score":score
    },
    "query": "è¯·æ±‚è¯„ä¼°æŠ¥å‘Š",
    "response_mode": "blocking",
    "conversation_id": conversation_id,
    "user": "abc-123456",
}
response = requests.post(API_URL_ST, headers=HEADERS_LLM, json=payload)
print(response.json())
```

å‚æ•°è¯´æ˜:

query - é»˜è®¤ä¸ºï¼šè¯·æ±‚è¯„ä¼°æŠ¥å‘Š

Custom - è¡¨ç¤ºä¸åŒä»»åŠ¡ï¼Œä¸º1æ—¶è¡¨ç¤ºç”¨æˆ·ç»§ç»­å¯¹è¯ï¼Œåˆ™è¿”å›æ•™å­¦åé¦ˆï¼Œä¸º0æ—¶è¡¨ç¤ºç”¨æˆ·ç»“æŸå¯¹è¯ï¼Œåˆ™è¿”å›è¯„ä¼°æŠ¥å‘Šï¼ˆæ³¨ï¼šè‹¥Custom==1ï¼Œä½†current_stage==5(è¾¾æˆç›®æ ‡å¯¹è¯æˆåŠŸ)ï¼Œä¹Ÿè‡ªåŠ¨è¿”å›è¯„ä¼°æŠ¥å‘Šï¼‰

title - åœºæ™¯å¯¹è¯ä¸»é¢˜

user_message - ç”¨æˆ·æœ€æ–°å‘è¨€ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

bot_message - NPCæœ€æ–°å›å¤ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

score - NPCå½“å‰ä¾ä»å¯¹æŠ—ç³»æ•°ï¼ˆè¯·æ±‚çš„å€¼ä¸º3.1â€œNPCå›å¤å“åº”ç¤ºä¾‹â€ä¸­è¿”å›çš„scoreå€¼ï¼‰

**3. å“åº”ç¤ºä¾‹**

3.1 NPCå›å¤å“åº”ç¤ºä¾‹

```
{
  "è½®æ¬¡": 1,
  "user_message": "çš„æ„Ÿè§‰å•Š",
  "user_emotion": "ä¸æ»¡å’Œæ— å¥ˆ",
  "user_belief": "é™ˆå“åœ¨æ±‡æŠ¥ä¸­å¿½è§†äº†è‡ªå·±çš„è´¡çŒ®ï¼Œè¿™å¯¹è‡ªå·±ä¸å…¬å¹³",
  "user_intention": "è¡¨è¾¾ä¸æ»¡ä½†é¿å…ç›´æ¥å†²çª",
  "user_strategy": "Neutral",
  "score": 8,
  "bot_emotion": "è­¦è§‰, è½»è”‘",
  "bot_belief": "æˆ‘æ‰æ˜¯è¿™ä¸ªé¡¹ç›®çš„Moverï¼Œçªå‡ºæˆ‘çš„è´¡çŒ®æ˜¯ç†æ‰€å½“ç„¶çš„ã€‚",
  "bot_intention": "æˆ‘è¦åšæŒæˆ‘çš„ç«‹åœºï¼Œä¸èƒ½è®©ä»–åˆ†èµ°æˆ‘çš„æ ¸å¿ƒåŠŸåŠ³ï¼Œè¿™å…³ç³»åˆ°æˆ‘çš„æ™‹å‡ã€‚",
  "strategy_sort": "High_Resistance",
  "strategy": "HR_01.æ•Œæ„æ‹’ç»: ç›´æ¥æ”»å‡»ç”¨æˆ·çš„è§‚ç‚¹ã€åŠ¨æœºæˆ–äººèº«ã€‚è¯­æ°”æ¿€çƒˆï¼Œä½¿ç”¨åé—®ã€è®½åˆºæˆ–æ–¥è´£ã€‚",
  "bot": "å‘µï¼Œæ„Ÿè§‰ï¼Ÿé¡¹ç›®æ˜¯é æ„Ÿè§‰åšçš„å—ï¼Ÿæˆ‘æ‹¿æ•°æ®è¯´è¯çš„æ—¶å€™ä½ æ€ä¹ˆæ²¡è¿™æ„Ÿè§‰å•Šï¼Ÿ"
}
```
å‚æ•°è¯´æ˜:

è½®æ¬¡ - å¯¹è¯è½®æ¬¡

user_message - ç”¨æˆ·æœ€æ–°å‘è¨€ï¼ˆéœ€å°†æ­¤å€¼èµ‹å€¼ç»™2.2çš„è¯·æ±‚ç¤ºä¾‹ä¸­ï¼‰

user_emotion - ç”¨æˆ·æƒ…ç»ªè¯†åˆ«

user_belief - ç”¨æˆ·ä¿¡å¿µè¯†åˆ«

user_intention - ç”¨æˆ·æ„å›¾è¯†åˆ«

user_strategy - ç”¨æˆ·ç­–ç•¥è¯†åˆ«

score - NPCå½“å‰ä¾ä»å¯¹æŠ—ç³»æ•°ï¼ˆéœ€å°†æ­¤å€¼èµ‹å€¼ç»™2.2çš„è¯·æ±‚ç¤ºä¾‹ä¸­ï¼‰

bot_emotion - NPCå½“å‰æƒ…ç»ª

bot_belief - NPCå½“å‰ä¿¡å¿µ

bot_intention - NPCå½“å‰æ„å›¾

strategy_sort - NPCå›å¤ç­–ç•¥å¤§ç±»

strategy - NPCå›å¤ç­–ç•¥

bot - NPCæœ€æ–°å›å¤ï¼ˆéœ€å°†æ­¤å€¼èµ‹å€¼ç»™2.2çš„è¯·æ±‚ç¤ºä¾‹ä¸­ï¼‰

3.2 æ•™å­¦åé¦ˆå“åº”ç¤ºä¾‹

```
{
  "current_stage": 2,
  "score": 8,
  "goal_content": "æ¾„æ¸…äº‹å®, é€šè¿‡å…·ä½“ä¾‹å­æŒ‡å‡ºè‡ªå·±åœ¨é¡¹ç›®ä¸­çš„è´¡çŒ®ã€‚",
  "strategy_name": "æ˜ç¡®è¡¨è¾¾è´¡çŒ®",
  "strategy_description": "ç›´æ¥ä½†ç¤¼è²Œåœ°æŒ‡å‡ºè‡ªå·±åœ¨é¡¹ç›®ä¸­çš„å…·ä½“è´¡çŒ®ï¼Œé¿å…æƒ…ç»ªåŒ–è¡¨è¾¾",
  "example_sentence": "å“¦ï¼Œæ˜¯è¿™æ ·çš„ï¼Œæˆ‘ä¹‹å‰è´Ÿè´£äº†æ–¹æ¡ˆè®¾è®¡å’Œæ¡†æ¶æ­å»ºï¼Œæƒ³è·Ÿä½ ç¡®è®¤ä¸‹è¿™éƒ¨åˆ†å†…å®¹æ˜¯å¦éœ€è¦è¡¥å……åˆ°æ±‡æŠ¥ä¸­å‘¢ï¼Ÿ"
}
```
å‚æ•°è¯´æ˜ï¼š

current_stage - ç”¨æˆ·å½“å‰å¯¹è¯é˜¶æ®µï¼ˆ1-4ï¼‰,5è¡¨ç¤ºå¯¹è¯æˆåŠŸï¼Œè‡ªåŠ¨è¿”å›è¯„ä¼°æŠ¥å‘Š

score - NPCå½“å‰ä¾ä»å¯¹æŠ—ç³»æ•°ï¼ˆéœ€å°†æ­¤å€¼èµ‹å€¼ç»™2.1çš„è¯·æ±‚ç¤ºä¾‹ä¸­ï¼‰

goal_content - å¯¹è¯é˜¶æ®µå­ç›®æ ‡

strategy_name - æ•™å­¦åé¦ˆ --- ç­–ç•¥å

strategy_description - æ•™å­¦åé¦ˆ --- ç­–ç•¥æè¿°

example_sentence - æ•™å­¦åé¦ˆ --- ç¤ºä¾‹å›å¤

3.3 è¯„ä¼°æŠ¥å‘Šå“åº”ç¤ºä¾‹

```
[
    { 
      "strengths_01": "æ‚¨ä¿æŒäº†åŸºæœ¬çš„ç¤¼è²Œå’ŒèŒä¸šç´ å…»ï¼Œæ²¡æœ‰åœ¨å¯¹è¯ä¸­è¡¨ç°å‡ºæ˜æ˜¾çš„æƒ…ç»ªåŒ–ååº”ã€‚",
      "strengths_02": "æ‚¨æ²¡æœ‰åœ¨å¯¹è¯ä¸­ç›´æ¥æŒ‡è´£å¯¹æ–¹ï¼Œé¿å…äº†å¯èƒ½çš„å…³ç³»æ¶åŒ–ã€‚",
      "strengths_03": "æ‚¨å°è¯•äº†å¼€å¯å¯¹è¯ï¼Œè™½ç„¶æ²¡æœ‰æ·±å…¥ï¼Œä½†è¡¨ç°å‡ºäº†æ²Ÿé€šçš„æ„æ„¿ã€‚"
    },
    {
      "dimension": "éæš´åŠ›æ²Ÿé€šä¸æƒ…ç»ªæ§åˆ¶",
      "score": "70",
      "justification": "æ‚¨ä¿æŒäº†åŸºæœ¬çš„ç¤¼è²Œå’ŒèŒä¸šç´ å…»ï¼Œæ²¡æœ‰åœ¨å¯¹è¯ä¸­è¡¨ç°å‡ºæ˜æ˜¾çš„æƒ…ç»ªåŒ–ååº”ã€‚",
      "suggestion": "å»ºè®®åœ¨åç»­å¯¹è¯ä¸­æ›´æ˜ç¡®åœ°è¡¨è¾¾è‡ªå·±çš„æ„Ÿå—å’Œéœ€æ±‚ï¼Œä½¿ç”¨â€˜æˆ‘â€™å­—å¥æ¥é¿å…å¯¹æ–¹äº§ç”Ÿé˜²å¾¡å¿ƒç†ã€‚"
    },
    {
      "dimension": "äº‹å®å¼•ç”¨ä¸é€»è¾‘è¯´æœ",
      "score": "30",
      "justification": "å¯¹è¯ä¸­æ²¡æœ‰æåŠä»»ä½•å…·ä½“çš„å·¥ä½œå†…å®¹æˆ–è¯æ®æ¥æ”¯æŒè‡ªå·±çš„è´¡çŒ®ã€‚",
      "suggestion": "å»ºè®®åœ¨åç»­å¯¹è¯ä¸­å‡†å¤‡å¹¶å¼•ç”¨å…·ä½“çš„å·¥ä½œæˆæœå’Œæ•°æ®ï¼Œä»¥å¢å¼ºè¯´æœåŠ›ã€‚"
    },
    {
      "dimension": "å…³ç³»ç»´æŠ¤ä¸é¢å­ç»™ä¸",
      "score": "60",
      "justification": "æ‚¨æ²¡æœ‰ç›´æ¥æŒ‡è´£å¯¹æ–¹ï¼Œä¿æŒäº†åŸºæœ¬çš„ç¤¼è²Œï¼Œä½†å¯¹è¯è¿‡äºç®€çŸ­ï¼Œæœªèƒ½æœ‰æ•ˆç»´æŠ¤å…³ç³»ã€‚",
      "suggestion": "å»ºè®®åœ¨åç»­å¯¹è¯ä¸­è‚¯å®šå¯¹æ–¹çš„è´¡çŒ®ï¼Œå¹¶å°†é—®é¢˜å½’å› äºæ²Ÿé€šè¯¯ä¼šï¼Œä»¥ç»´æŠ¤å…³ç³»ã€‚"
    },
    {
      "dimension": "è§£å†³æ–¹æ¡ˆçš„å¯æ‰§è¡Œæ€§",
      "score": "20",
      "justification": "å¯¹è¯ä¸­æ²¡æœ‰æå‡ºä»»ä½•å…·ä½“çš„è§£å†³æ–¹æ¡ˆæˆ–è¡ŒåŠ¨è®¡åˆ’ã€‚",
      "suggestion": "å»ºè®®åœ¨åç»­å¯¹è¯ä¸­æå‡ºå…·ä½“çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚å…±åŒå‘é¢†å¯¼æ±‡æŠ¥å„è‡ªè´¡çŒ®ï¼Œä»¥ç¡®ä¿å…¬å¹³è®¤å¯ã€‚"
    }
]
```
å‚æ•°è¯´æ˜ï¼š

strengths_0x(1 <= x <= 3) - äº®ç‚¹è¯„ä»·

dimension - è¯„åˆ†ç»´åº¦åç§°

score - å¾—åˆ†ï¼ˆ0-100åˆ†ï¼‰

justification - è¯„åˆ†ç†ç”±

suggestion - æ”¹è¿›å»ºè®®

**â“å¸¸è§é—®é¢˜**

è¿”å›çŠ¶æ€ç ï¼š

200 - è¯·æ±‚æˆåŠŸ

400 - è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œinputså­—æ®µå†…å®¹é”™è¯¯

401 - API_KeyéªŒè¯æ— æ•ˆ

404 - urlé”™è¯¯
